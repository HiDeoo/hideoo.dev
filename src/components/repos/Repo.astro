---
import RepoLink from '@components/repos/RepoLink.astro'
import Tag from '@components/ui/Tag.astro'
import VisuallyHidden from '@components/ui/VisuallyHidden.astro'
import { type GitHubRepo } from '@libs/github'
import { pluralize } from '@libs/string'

export interface Props {
  repo: GitHubRepo
}

const { repo } = Astro.props

const shouldShowStars = repo.stars > 0

const listFormatter = new Intl.ListFormat('en', { style: 'short', type: 'conjunction' })
---

<RepoLink class="link" href={repo.url} title={`Open ${repo.name} GitHub repository`}>
  <VisuallyHidden>
    {repo.name} - {shouldShowStars ? `Starred ${repo.stars} ${pluralize(repo.stars, 'time', 'times')} - ` : ''}{
      repo.description
    } - Built with {listFormatter.format(repo.languages.map((language) => language.name))}.
  </VisuallyHidden>
  <div aria-hidden="true" class="name">
    <strong>{repo.name}</strong>
    {
      shouldShowStars ? (
        <div class="stars">
          {repo.stars}
          <svg viewBox="0 0 25 25">
            <g>
              <path d="M 13.21875 0.695312 C 12.953125 0.75 12.628906 1.015625 12.332031 1.429688 C 11.929688 2 11.582031 2.6875 10.765625 4.550781 C 10.085938 6.09375 9.816406 6.640625 9.460938 7.164062 C 9.046875 7.769531 8.761719 7.890625 7.742188 7.890625 C 7.152344 7.890625 6.625 7.851562 5.171875 7.6875 C 4.566406 7.617188 3.871094 7.542969 3.355469 7.496094 C 2.980469 7.460938 1.804688 7.460938 1.585938 7.496094 C 0.882812 7.605469 0.558594 7.835938 0.53125 8.242188 C 0.519531 8.492188 0.617188 8.757812 0.847656 9.105469 C 1.230469 9.679688 1.851562 10.300781 3.421875 11.6875 C 5.289062 13.339844 5.859375 13.984375 5.945312 14.523438 C 6.015625 14.984375 5.757812 15.804688 5.058594 17.375 C 4.347656 18.96875 4.21875 19.253906 4.101562 19.539062 C 3.609375 20.734375 3.414062 21.492188 3.480469 21.953125 C 3.539062 22.390625 3.761719 22.605469 4.175781 22.632812 C 4.785156 22.671875 5.679688 22.300781 7.5 21.257812 C 8.964844 20.414062 9.230469 20.265625 9.554688 20.09375 C 10.4375 19.625 10.960938 19.429688 11.363281 19.425781 C 11.597656 19.421875 11.675781 19.445312 11.96875 19.589844 C 12.484375 19.851562 13.089844 20.332031 14.511719 21.621094 C 16.476562 23.410156 17.257812 23.976562 17.9375 24.113281 C 18.136719 24.15625 18.273438 24.140625 18.433594 24.0625 C 18.636719 23.960938 18.746094 23.796875 18.835938 23.46875 C 18.875 23.308594 18.878906 23.25 18.878906 22.851562 C 18.878906 22.609375 18.871094 22.328125 18.855469 22.226562 C 18.757812 21.484375 18.644531 20.910156 18.359375 19.617188 C 17.914062 17.601562 17.816406 17.027344 17.816406 16.402344 C 17.816406 16.085938 17.847656 15.894531 17.921875 15.726562 C 18.121094 15.296875 18.828125 14.769531 20.417969 13.867188 C 21.707031 13.132812 22.042969 12.945312 22.382812 12.738281 C 23.828125 11.867188 24.464844 11.25 24.464844 10.734375 C 24.464844 10.429688 24.277344 10.199219 23.867188 9.992188 C 23.277344 9.703125 22.402344 9.53125 20.417969 9.328125 C 18.359375 9.117188 17.808594 9.039062 17.214844 8.886719 C 16.457031 8.691406 16.210938 8.492188 15.949219 7.882812 C 15.71875 7.34375 15.535156 6.652344 15.183594 4.984375 C 14.917969 3.726562 14.769531 3.085938 14.617188 2.570312 C 14.394531 1.792969 14.148438 1.265625 13.875 0.960938 C 13.691406 0.757812 13.441406 0.65625 13.21875 0.695312 Z M 13.21875 0.695312" />
            </g>
          </svg>
        </div>
      ) : null
    }
  </div>
  <div aria-hidden="true" class="description">{repo.description}</div>
  <ul aria-hidden="true" class="languages">
    {
      repo.languages.map((language) => (
        <Tag as="li" color={language.color}>
          {language.name}
        </Tag>
      ))
    }
  </ul>
</RepoLink>

<style>
  .link {
    padding: var(--size-3);
    padding-bottom: var(--size-4);

    @media (--motionSafe) {
      &:hover svg {
        animation-play-state: running;
      }
    }
  }

  .name {
    display: flex;
    gap: var(--size-4);
    justify-content: space-between;

    & strong {
      font-weight: var(--font-semibold);
      font-size: var(--text-xl);
    }
  }

  .stars {
    align-items: center;
    background-color: var(--bg-color);
    color: var(--color-dimmed);
    display: flex;
    font-weight: var(--font-medium);
  }

  svg {
    --size: var(--size-4);

    fill: currentColor;
    height: var(--size);
    margin-left: 0.375rem;
    position: relative;
    top: -1px;
    width: var(--size);

    @media (--motionSafe) {
      animation: spin var(--duration-3000) linear infinite;
      animation-play-state: paused;
    }
  }

  .description {
    color: var(--color-dimmed);
    display: -webkit-box;
    flex-grow: 1;
    font-size: 0.95rem;
    line-height: var(--line-height-6);
    margin-block: var(--size-2) 0.75rem;
    overflow: hidden;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
  }

  .languages {
    display: flex;
    gap: var(--size-4);
    overflow-x: auto;
    padding-bottom: var(--size-1);
    scrollbar-width: none;

    &::-webkit-scrollbar {
      height: 0;
      width: 0;
    }
  }

  @keyframes spin {
    to {
      transform: rotate(1turn);
    }
  }
</style>
